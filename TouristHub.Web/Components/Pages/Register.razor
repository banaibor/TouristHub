@rendermode InteractiveServer

@page "/register"

@using System.Net.Http.Json

@inject HttpClient Http

<PageTitle>Register</PageTitle>

<h3>User Registration</h3>

<EditForm Model="registerModel" OnValidSubmit="HandleRegister" FormName="RegisterForm">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="username" class="form-label">Username</label>
        <InputText id="username" class="form-control" @bind-Value="registerModel.Username" />
    </div>
    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <InputText id="email" class="form-control" @bind-Value="registerModel.Email" />
    </div>
    <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <InputText type="password" @bind-Value="registerModel.Password" class="form-control" id="password" />
    </div>
    <div class="mb-3">
        <label for="role" class="form-label">Role</label>
        <InputSelect id="role" class="form-control" @bind-Value="registerModel.Role">
            <option value="">Select Role</option>
            <option value="USER">User</option>
            <option value="MANAGER">Manager</option>
            <option value="ADMIN">Admin</option>
        </InputSelect>
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
</EditForm>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert alert-info mt-3">@message</div>
}

@code {
    private RegisterModel registerModel = new RegisterModel();
    private string? message;

    private async Task HandleRegister()
    {
        var response = await Http.PostAsJsonAsync("/api/Account/register", registerModel);
        if (response.IsSuccessStatusCode)
        {
            message = "Registration successful!";
        }
        else
        {
            var error = await response.Content.ReadAsStringAsync();
            message = $"Registration failed: {error}";
        }
    }

    public class RegisterModel
    {
        public string Username { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Password { get; set; } = string.Empty;
        public string Role { get; set; } = string.Empty;
    }
}
